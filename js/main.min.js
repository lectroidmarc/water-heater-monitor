Highcharts.setOptions({global:{useUTC:!1}});var makeTempGauges=function(a){makeTempGauge("#aux_2_g",""!==a.aux_2?parseFloat(a.aux_2):0,"Water Temperature"),makeTempGauge("#stor_t_g",""!==a.stor_t?parseFloat(a.stor_t):0,"Storage Temperature"),makeTempGauge("#coll_t_g",""!==a.coll_t?parseFloat(a.coll_t):0,"Collector Temperature",250),makeTempGauge("#ambient_t_g",parseFloat(a.ambient_t.replace(/\s+/,"")),"Ambient Temperature",140)},makeTempGauge=function(a,b,c,d){d=d||200,$(a).highcharts({chart:{type:"solidgauge"},credits:{enabled:!1},pane:{center:["50%","85%"],size:"100%",startAngle:-90,endAngle:90,background:{backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}},title:null,tooltip:{enabled:!1},yAxis:{min:0,max:d,stops:[[.3,"#00ccff"],[.5,"#cccc00"],[.7,"#ffcc00"],[.9,"#ff3300"]],lineWidth:0,minorTickInterval:null,tickPositions:[0,d],tickWidth:0,title:{style:{fontSize:"14px"},text:c,y:-70},labels:{y:15}},series:[{data:[b],dataLabels:{formatter:function(){return'<div class="temp">'+Highcharts.numberFormat(this.y,1)+"&deg;</div>"}}}]})},makeGraph=function(a,b){function c(){for(var a=[],c=b.length-1;c>=0;c--)if(c>0&&("ON"===b[c].pump||"ON"===b[c].uplim)){var d=Date.parse(b[c].timestamp),e=Date.parse(b[c-1].timestamp);66e4>e-d&&a.push({color:"ON"===b[c].pump?"aliceblue":"#ffeedd",from:d,to:e})}return a}function d(a){for(var c=[],d=b.length-1;d>=0;d--){var e=Date.parse(b[d].timestamp),f=parseFloat(b[d][a].replace(/\s+/,""));if(("pump"===a||"uplim"===a)&&(f="ON"===b[d][a]?1:0),c.push([e,isNaN(f)?null:f]),d>0){var g=Date.parse(b[d-1].timestamp);g-e>66e4&&c.push([Date.parse((e+g)/2),null])}}return c}$(a).highcharts({chart:{borderColor:"#ccc",borderRadius:4,borderWidth:1,type:"line",zoomType:"x"},plotOptions:{line:{marker:{enabled:!1}}},title:null,tooltip:{valueSuffix:"°F"},xAxis:{type:"datetime",plotBands:c()},yAxis:{title:{text:"Temperature (°F)"},plotLines:[{color:"#aaa",dashStyle:"LongDash",value:120,width:"1"},{color:"red",dashStyle:"LongDash",value:160,width:"1"}]},series:[{name:"Water Temp",data:d("aux_2"),color:"#4da64d",zIndex:5},{name:"Storage Temp",data:d("stor_t"),color:"#aed6f6",zIndex:4},{name:"Collector Temp",data:d("coll_t"),color:"#ebc03f",zIndex:3},{name:"Return Temp",data:d("aux_1"),color:"#ebc03f",dashStyle:"shortdot",zIndex:2},{name:"Ambient Temp",data:d("ambient_t"),color:"#933feb",zIndex:1},{name:"Pump Status",data:d("pump"),showInLegend:!1,visible:!1},{name:"Upper Limit Status",data:d("uplim"),showInLegend:!1,visible:!1}]})},updateGraph=function(a,b){function c(a,c){var d=Date.parse(b[c].timestamp),e=parseFloat(b[c][a].replace(/\s+/,""));return[d,isNaN(e)?null:e]}for(var d=$(a).highcharts(),e=b.length-1;e>=0;e--){d.series[0].addPoint(c("aux_2",e),!0,!0),d.series[1].addPoint(c("stor_t",e),!0,!0),d.series[2].addPoint(c("coll_t",e),!0,!0),d.series[3].addPoint(c("aux_1",e),!0,!0),d.series[4].addPoint(c("ambient_t",e),!0,!0);var f=d.series[5].points[d.series[5].points.length-1].x,g=d.series[5].points[d.series[5].points.length-1].y,h=d.series[6].points[d.series[6].points.length-1].y;(1===g||1===h)&&d.xAxis[0].addPlotBand({from:f,to:Date.parse(b[e].timestamp),color:1===g?"aliceblue":"#ffeedd"}),d.series[5].addPoint(c("pump",e),!0,!0),d.series[6].addPoint(c("uplim",e),!0,!0)}},phant,page,wu,init=function(){$('a[data-toggle="tab"]').on("shown.bs.tab",onTabChange),$("#settings form").on("submit",onSettingsSubmit),$(".previous").on("click",onPageBack),$(".next").on("click",onPageForward),init_phant(),init_weather()},init_phant=function(){var a=JSON.parse(window.localStorage.getItem("phant_settings"));a?($("#phant_url").val(a.url),$("#phant_public_key").val(a.public_key),showAlert("Loading...",{faClass:"refresh",faSpin:!0}),phant=new Phant(a),page=1,phant.fetch({page:page},onPhantFetch,onPhantError)):$("#tabs a:last").tab("show")},init_weather=function(){var a=JSON.parse(window.localStorage.getItem("wu_settings"));a&&a.api_key&&a.location&&($("#wu_api_key").val(a.api_key),$("#wu_location").val(a.location),wu=new WeatherUnderground({api_key:a.api_key,location:a.location}),wu.conditions(onWeatherConditions))},onPageBack=function(a){a.preventDefault(),$(".pager li").addClass("disabled"),page++,phant.fetch({page:page},onPhantPage,onPhantError)},onPageForward=function(a){a.preventDefault(),page>1&&($(".pager li").addClass("disabled"),page--,phant.fetch({page:page},onPhantPage,onPhantError))},onTabChange=function(a){switch($(a.target).attr("href")){case"#home":init_phant(),init_weather();break;case"#update":break;case"#settings":$("#update .result").hide()}},onSettingsSubmit=function(a){a.preventDefault(),window.localStorage.setItem("phant_settings",JSON.stringify({url:$("#phant_url").val(),public_key:$("#phant_public_key").val()})),window.localStorage.setItem("wu_settings",JSON.stringify({api_key:$("#wu_api_key").val(),location:$("#wu_location").val()})),$("#tabs a:first").tab("show")},onPhantFetch=function(a){if(phant.getStats(onPhantStats),a.message)showAlert(a.message,{alertClass:"danger",faClass:"warning"});else if(a.length>0){$(".pager").show();var b=a.filter(filterTempData),c=b.sort(sortTempData),d=c[0];showStatus(d),makeTempGauges(d),makeGraph("#plot",c),phant.startPolling({},onPhantPolled)}else clearAlerts()},onPhantPage=function(a){if($(".pager li > a").blur(),$(".pager li").removeClass("disabled"),$(".pager .next").toggleClass("disabled",1===page),a.message)showAlert(a.message,{alertClass:"danger",faClass:"warning"});else{var b=a.filter(filterTempData),c=b.sort(sortTempData);makeGraph("#plot",c)}},onPhantError=function(){showAlert("A network error occured",{alertClass:"danger",faClass:"warning"})},onPhantPolled=function(a){if(a.message)showAlert(a.message,{alertClass:"danger",faClass:"warning"});else if(a.length>0){var b=a[0];showStatus(b),makeTempGauges(b),1===page&&updateGraph("#plot",a),wu&&wu.conditions(onWeatherConditions)}},onPhantStats=function(a){var b=a.used/a.cap*100;$(".stats").attr("title",b.toFixed(2)+"% space used."),$(".stats .progress-bar").css({width:b.toFixed(2)+"%"})},showStatus=function(a){var b=Date.parse(a.timestamp),c=Date.now()-b>66e4?!0:!1,d=""===a.coll_t&&""===a.stor_t&&""===a.aux_1&&""===a.aux_2?!0:!1;if(c){var e=new Date(b);showAlert("Monitor appears offline.  Last update at <strong>"+e.toLocaleString()+"</strong>",{alertClass:"danger",faClass:"warning"})}else d?showAlert("System is OFF",{alertClass:"gray",faClass:"power-off"}):"ON"===a.uplim?showAlert("High Limit hit",{alertClass:"warning",faClass:"warning"}):"ON"===a.pump?showAlert("Pump is ON",{alertClass:"success",faClass:"check"}):showAlert("Pump is OFF",{alertClass:"info",faClass:"power-off"});d?$(".hidden-xs-systemoff").addClass("off"):$(".hidden-xs-systemoff").removeClass("off")},showAlert=function(a,b){clearAlerts(),"undefined"==typeof b&&(b={});var c=$("<div/>").addClass("status alert alert-"+(b.alertClass||"info")).appendTo("#alerts");if(b.glyphiconClass||b.faClass){var d=$("<span/>").attr("aria-hidden","true").appendTo(c);b.glyphiconClass&&d.addClass("glyphicon glyphicon-"+b.glyphiconClass),b.faClass&&d.addClass("fa fa-"+b.faClass),b.faSpin&&d.addClass("fa-spin")}return $("<span/>").addClass("text").html(a).appendTo(c),c},clearAlerts=function(){$("#alerts .status").remove()},filterTempData=function(a){return-1!==a.runtime.indexOf(":")},sortTempData=function(a,b){var c=Date.parse(a.timestamp),d=Date.parse(b.timestamp);return c>d?-1:d>c?1:0},onWeatherConditions=function(a){if(!a.response.error){var b=a.current_observation.temp_f,c=a.current_observation.weather,d=a.current_observation.forecast_url,e=a.current_observation.icon,f=a.current_observation.icon_url,g=-1!==f.indexOf("nt_"+e+".")?"nt_":"",h=$("#weather");0===h.length?(h=$("<a/>").attr({id:"weather",target:"weather",href:d,title:"Currently: "+c+", "+b+"°"}).prependTo("#header"),$("<div/>").addClass("weather-icon "+g+e).appendTo(h),$("<div/>").addClass("temp").text(b+"°").appendTo(h)):(h.attr({href:d,title:"Currently: "+c+", "+b+"°"}),h.find(".weather-icon").removeClass().addClass("weather-icon "+g+e),h.find(".temp").text(b+"°").appendTo(h))}};$(document).ready(init);var Parameters=function(a){this.params="object"==typeof a?a:{}};Parameters.prototype.set=function(a,b){this.params[a]=b},Parameters.prototype.serialize=function(){var a=[];for(var b in this.params)this.params.hasOwnProperty(b)&&a.push(encodeURIComponent(b)+"="+encodeURIComponent(this.params[b]));return a.join("&")},Parameters.prototype.formData=function(){var a=new FormData;for(var b in this.params)this.params.hasOwnProperty(b)&&a.append(b,this.params[b]);return a};var Phant=function(a){this.url=a.url,this.public_key=a.public_key,this.private_key=a.private_key};Phant.prototype.fetch=function(a,b,c){var d=this,e=new Parameters(a),f=new XMLHttpRequest;f.open("GET",this.url+"/output/"+this.public_key+".json?"+e.serialize()),f.responseType="json",f.onload=function(){Array.isArray(this.response)&&this.response.length>0&&(d._current_data_timestamp=this.response[0].timestamp),b(this.response)},f.onerror=function(){"function"==typeof c&&c()},f.send()},Phant.prototype.update=function(a,b){var c=new Parameters(a),d=new XMLHttpRequest;d.open("POST",this.url+"/input/"+this.public_key+".json"),d.setRequestHeader("Phant-Private-Key",this.private_key),d.responseType="json",d.onload=function(){b(this.response)},d.send(c.formData())},Phant.prototype.clear=function(a){var b=new XMLHttpRequest;b.open("DELETE",this.url+"/input/"+this.public_key+".json"),b.setRequestHeader("Phant-Private-Key",this.private_key),b.responseType="json",b.onload=function(){a(this.response)},b.send()},Phant.prototype.getStats=function(a){var b=new XMLHttpRequest;b.open("GET",this.url+"/output/"+this.public_key+"/stats.json"),b.responseType="json",b.onload=function(){a(this.response)},b.send()},Phant.prototype.enableRealtime=function(a){var b=this,c=document.createElement("script");c.setAttribute("src",this.url+"/js/phant-manager.min.js"),c.async=!0,c.onload=function(){"undefined"!=typeof mows&&(this._client=mows.createClient(b.url.replace(/^http/,"ws")),this._client.subscribe("output/"+b.public_key),this._client.on("message",function(b,c){a(JSON.parse(c))}))},document.body.appendChild(c)},Phant.prototype.startPolling=function(a,b,c){var d=this;this._poll_timeout=window.setTimeout(function(){if(d._current_data_timestamp){var e=a||{};e["gt[timestamp]"]=d._current_data_timestamp,d.fetch(e,function(e){d.startPolling(a,b,c),b(e)})}else d.startPolling(a,b,c)},c||6e4)},Phant.prototype.stopPolling=function(){window.clearTimeout(this._poll_timeout)};var WeatherUnderground=function(a){this.api_key=a.api_key,this.location=a.location,this.cache_seconds=a.cache_seconds||900};WeatherUnderground.prototype.conditions=function(a){this._wuAPI("conditions",a)},WeatherUnderground.prototype._wuAPI=function(a,b){var c="wu_"+this.location,d=this.cache_seconds;if(d>0){var e=window.localStorage.getItem(c);try{var f=JSON.parse(e);if(f.expiry>Date.now())return void b(f.data)}catch(g){}}var h=new XMLHttpRequest;h.open("GET","https://api.wunderground.com/api/"+this.api_key+"/"+a+"/q/"+this.location+".json"),h.responseType="json",h.onload=function(){d>0&&window.localStorage.setItem(c,JSON.stringify({expiry:Date.now()+1e3*d,data:this.response})),b(this.response)},h.send()};
//# sourceMappingURL=main.min.js.map