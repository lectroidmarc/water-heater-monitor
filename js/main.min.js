Highcharts.setOptions({global:{useUTC:!1}});var makeTempGauges=function(a){makeTempGauge("#aux_2_g",""!==a.aux_2?parseFloat(a.aux_2):0,"Water Temperature"),makeTempGauge("#stor_t_g",""!==a.stor_t?parseFloat(a.stor_t):0,"Storage Temperature"),makeTempGauge("#coll_t_g",""!==a.coll_t?parseFloat(a.coll_t):0,"Collector Temperature",250),makeTempGauge("#ambient_t_g",parseFloat(a.ambient_t),"Ambient Temperature",140)},makeTempGauge=function(a,b,c,d){d=d||200,$(a).highcharts({chart:{type:"solidgauge"},credits:{enabled:!1},pane:{center:["50%","85%"],size:"100%",startAngle:-90,endAngle:90,background:{backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}},title:null,tooltip:{enabled:!1},yAxis:{min:0,max:d,stops:[[.3,"#00ccff"],[.5,"#cccc00"],[.7,"#ffcc00"],[.9,"#ff3300"]],lineWidth:0,minorTickInterval:null,tickPositions:[0,d],tickWidth:0,title:{text:c,y:-70},labels:{y:15}},series:[{data:[b],dataLabels:{formatter:function(){return'<div class="temp">'+Highcharts.numberFormat(this.y,1)+"&deg;</div>"}}}]})},makeGraph=function(a,b){function c(){for(var a=[],c=b.length-1;c>=0;c--)if(c>0&&("ON"==b[c].pump||"ON"==b[c].uplim)){var d=Date.parse(b[c].timestamp),e=Date.parse(b[c-1].timestamp);66e4>e-d&&a.push({color:"ON"==b[c].pump?"aliceblue":"#ffeedd",from:d,to:e})}return a}function d(a){for(var c=[],d=b.length-1;d>=0;d--){var e=Date.parse(b[d].timestamp),f=parseFloat(b[d][a]);if(("pump"===a||"uplim"===a)&&(f="ON"===b[d][a]?1:0),c.push([e,isNaN(f)?null:f]),d>0){var g=Date.parse(b[d-1].timestamp);g-e>66e4&&c.push([Date.parse((e+g)/2),null])}}return c}$(a).highcharts({chart:{borderColor:"#ccc",borderRadius:4,borderWidth:1,type:"line",zoomType:"x"},plotOptions:{line:{marker:{enabled:!1}}},title:null,tooltip:{valueSuffix:"°F"},xAxis:{type:"datetime",plotBands:c()},yAxis:{title:{text:"Temperature (°F)"}},series:[{name:"Water Temp",data:d("aux_2"),color:"#4da64d",zIndex:5},{name:"Storage Temp",data:d("stor_t"),color:"#aed6f6",zIndex:4},{name:"Collector Temp",data:d("coll_t"),color:"#ebc03f",zIndex:3},{name:"Return Temp",data:d("aux_1"),color:"#ebc03f",dashStyle:"shortdot",zIndex:2},{name:"Ambient Temp",data:d("ambient_t"),color:"#933feb",zIndex:1}]})},updateGraph=function(a,b){function c(a,c){var d=Date.parse(b[c].timestamp),e=parseFloat(b[c][a]);return[d,isNaN(e)?null:e]}for(var d=$(a).highcharts(),e=b.length-1;e>=0;e--)d.series[0].addPoint(c("aux_2",e),!0,!0),d.series[1].addPoint(c("stor_t",e),!0,!0),d.series[2].addPoint(c("coll_t",e),!0,!0),d.series[3].addPoint(c("aux_1",e),!0,!0),d.series[4].addPoint(c("ambient_t",e),!0,!0)},phant,init=function(){$('a[data-toggle="tab"]').on("shown.bs.tab",onTabChange),$("#settings form").on("submit",onSettingsSubmit),$("#update").on("submit",onUpdateSubmit),$("#clear_btn").on("click",onClear);var a=JSON.parse(window.localStorage.getItem("phant_settings"));a?($("#phant_url").val(a.url),$("#phant_public_key").val(a.public_key),$("#phant_private_key").val(a.private_key),$("#clear_btn").prop("disabled",!a.private_key),phant=new Phant(a),phant.fetch({"gte[timestamp]":"t - 12h"},onPhantFetch),phant.getStats(onPhantStats)):$("#tabs a:last").tab("show")},onTabChange=function(a){switch($(a.target).attr("href")){case"#home":init();break;case"#settings":break;case"#settings":$("#update .result").hide()}},onSettingsSubmit=function(a){a.preventDefault(),window.localStorage.setItem("phant_settings",JSON.stringify({url:$("#phant_url").val(),public_key:$("#phant_public_key").val(),private_key:$("#phant_private_key").val()})),$("#clear_btn").prop("disabled",!$("#phant_private_key").val()),$("#tabs a:first").tab("show")},onPhantFetch=function(a){if(a.message)console.warn(a.message);else{var b=a[0];showStatus(b),updateFormValues(b),makeTempGauges(b),makeGraph("#plot",a),phant.startPolling({},onPhantPolled)}},onPhantRealtime=function(a){console.log(a)},onPhantPolled=function(a){if(a.message)console.warn(a.message);else if(a.length>0){var b=a[0];showStatus(b),updateFormValues(b),makeTempGauges(b),updateGraph("#plot",a)}},onPhantStats=function(a){var b=a.used/a.cap*100;$(".stats").attr("title",b.toFixed(2)+"% space used."),$(".stats .progress-bar").css({width:b.toFixed(2)+"%"})},onUpdateSubmit=function(a){if(a.preventDefault(),phant){var b={runtime:$("#runtime").val(),coll_t:$("#coll_t").val(),stor_t:$("#stor_t").val(),aux_1:$("#aux_1").val(),aux_2:$("#aux_2").val(),diff_t:$("#diff_t").val(),hili_t:$("#hili_t").val(),pump:$("#update input[name=pump]:checked").val(),uplim:$("#update input[name=uplim]:checked").val(),ambient_t:$("#ambient_t").val(),fault:""};phant.update(b,onPhantUpdateSubmitted)}},onPhantUpdateSubmitted=function(a){a.success?($("#update .result > span").text("Successfully updated "+phant.url),$("#update .result").removeClass("alert-danger").addClass("alert-success").show()):($("#update .result > span").text(a.message),$("#update .result").removeClass("alert-success").addClass("alert-danger").show())},onClear=function(){phant.clear(function(){$("#tabs a:first").tab("show")})},showStatus=function(a){var b=Date.parse(a.timestamp),c=Date.now()-b>66e4?!0:!1,d=""===a.coll_t&&""===a.stor_t&&""===a.aux_1&&""===a.aux_2?!0:!1;if($(".status").hide(),c){var e=new Date(b);$("#last_update_time").text(e.toLocaleString()),$(".status.outofdate").show()}else d?$(".status.systemoff").show():"ON"==a.uplim?$(".status.uplim").show():"ON"==a.pump?$(".status.pumpon").show():$(".status.pumpoff").show();d?$(".hidden-xs-systemoff").addClass("off"):$(".hidden-xs-systemoff").removeClass("off")},updateFormValues=function(a){$("#runtime").val(a.runtime),$("#coll_t").val(a.coll_t),$("#stor_t").val(a.stor_t),$("#aux_1").val(a.aux_1),$("#aux_2").val(a.aux_2),$("#ambient_t").val(a.ambient_t)};$(document).ready(init);var Parameters=function(a){this.params="object"==typeof a?a:{}};Parameters.prototype.set=function(a,b){this.params[a]=b},Parameters.prototype.serialize=function(){var a=[];for(var b in this.params)this.params.hasOwnProperty(b)&&a.push(encodeURIComponent(b)+"="+encodeURIComponent(this.params[b]));return a.join("&")},Parameters.prototype.formData=function(){var a=new FormData;for(var b in this.params)this.params.hasOwnProperty(b)&&a.append(b,this.params[b]);return a};var Phant=function(a){this.url=a.url,this.public_key=a.public_key,this.private_key=a.private_key};Phant.prototype.fetch=function(a,b){var c=this,d=new Parameters(a),e=new XMLHttpRequest;e.open("GET",this.url+"/output/"+this.public_key+".json?"+d.serialize()),e.responseType="json",e.onload=function(){Array.isArray(this.response)&&this.response.length>0&&(c._current_data_timestamp=this.response[0].timestamp),b(this.response)},e.send()},Phant.prototype.update=function(a,b){var c=new Parameters(a),d=new XMLHttpRequest;d.open("POST",this.url+"/input/"+this.public_key+".json"),d.setRequestHeader("Phant-Private-Key",this.private_key),d.responseType="json",d.onload=function(){b(this.response)},d.send(c.formData())},Phant.prototype.clear=function(a){var b=new XMLHttpRequest;b.open("DELETE",this.url+"/input/"+this.public_key+".json"),b.setRequestHeader("Phant-Private-Key",this.private_key),b.responseType="json",b.onload=function(){a(this.response)},b.send()},Phant.prototype.getStats=function(a){var b=new XMLHttpRequest;b.open("GET",this.url+"/output/"+this.public_key+"/stats.json"),b.responseType="json",b.onload=function(){a(this.response)},b.send()},Phant.prototype.enableRealtime=function(a){var b=this,c=document.createElement("script");c.setAttribute("src",this.url+"/js/phant-manager.min.js"),c.async=!0,c.onload=function(){"undefined"!=typeof mows&&(this._client=mows.createClient(b.url.replace(/^http/,"ws")),this._client.subscribe("output/"+b.public_key),this._client.on("message",function(b,c){a(JSON.parse(c))}))},document.body.appendChild(c)},Phant.prototype.startPolling=function(a,b,c){var d=this;this._poll_timeout=window.setTimeout(function(){if(d._current_data_timestamp){var e=a||{};e["gt[timestamp]"]=d._current_data_timestamp,d.fetch(e,function(e){d.startPolling(a,b,c),b(e)})}else d.startPolling(a,b,c)},c||6e4)},Phant.prototype.stopPolling=function(){window.clearTimeout(this._poll_timeout)};
//# sourceMappingURL=sourcemap.map